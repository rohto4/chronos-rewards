# チームが次に実装すべき項目一覧

## 現状（2026-02-22 時点）

**IMPLEMENTATION_STATUS.md と現コードの確認結果:**
- Phase 1-9: 機能実装は完了
- 品質KPI（カバレッジ/Lighthouse/実機検証）は継続改善
- **実装ギャップはほぼなし**

---

## 優先度別 実装タスク

### 🔴 高優先度（本番用途に必須）

#### [GAMIFY-001] Gamification & Rewards 仕様のフル実装
- **対象**: `docs/specs/gamification-spec.md`
- **範囲**:
  - Streak Multiplier / Pomodoro RPG / Skill Tree / Focus Gacha / Legacy Chronicles
  - 追加DBスキーマ・RPC・トリガー設計
  - UI/UX 実装（表示/操作/履歴/報酬消費）
  - テスト追加・ドキュメント更新
- **工数**: 2-4週間（実験的に一括実装）

#### [AUTH-001] Google OAuth 統合検証
- **状態**: コード実装済み、本番Supabase設定が必要
- **条件**: オーナーが Google Cloud Console で OAuth設定を完了（`docs/OWNER_TASK.md` 参照）
- **実装側の検証タスク**:
  1. ローカル環境で Google ログイン動作確認
  2. Vercel デプロイ後の Google ログイン動作確認
  3. コールバック URL の検証（`/app/auth/callback`）
  4. エラーハンドリング（認可キャンセル、ネットワーク障害）

#### [TYPE-001] Supabase auth-helpers 型推論バグの恒久対応
- **現状**: 3ファイルに `// @ts-nocheck` 暫定対応中
  - `lib/stores/genre-store.ts`
  - `lib/stores/task-store.ts`
  - `lib/stores/user-store.ts`
- **対応案①**: `@supabase/auth-helpers-nextjs` をアップグレード（v0.9.0 → 最新）
- **対応案②**: `@supabase/ssr` へ移行（より新しいパッケージ）
- **工数**: 2-4時間
- **優先度**: 中（機能には影響なし、型安全性向上）

---

### 🟡 中優先度（UX向上）

#### [MOBILE-001] 全ページのモバイルレスポンシブ検証
- **対象ページ**: `/dashboard`, `/calendar`, `/statistics`
- **確認項目**:
  - 横幅 375px～414px でのレイアウト崩れなし
  - タッチターゲット 48px 以上
  - スワイプ操作の反応性（TaskCard スワイプ完了など）
- **工数**: 3-4時間

#### [PWA-001] PWA機能の検証
- **確認項目**:
  - Web App Manifest の詳細（名前、説明、アイコン）
  - インストールプロンプトの動作
  - オフライン状態でのデータ表示（Realtime接続喪失時）
  - Service Worker のキャッシング戦略
- **工数**: 2-3時間

#### [ANALYTICS-001] 実装結果の統計情報更新
- **対象**: `IMPLEMENTATION_STATUS.md` と `finally_summary.md` の数値が古い可能性
- **確認**: 実際のコード行数・ファイル数を再集計
- **工数**: 1時間
- **状態**: 2026-02-22 更新済み（統計値を最新化）

---

### 🟢 低優先度（ポーランド・デバッグ）

#### [NEXT-001] Next.js メタデータ警告の対応
- **警告**: `metadata.themeColor` → `viewport` への移行
- **ファイル**: `app/layout.tsx`
- **工数**: 30分

#### [TEST-001] 既存テストスクリプトの実行確認
- **テストファイル**: `scripts/test-*.ts` (8ファイル)
- **確認内容**: 実機動作、カバレッジレポート生成
- **工数**: 2-3時間

#### [DOC-001] 設計書の統一性確認
- **確認項目**:
  - requirements.md と実装ページの機能一致
  - API_DESIGN.md と実際のエンドポイント一致
  - データベース設計と実装スキーマ一致
- **工数**: 1-2時間
- **状態**: 2026-02-22 更新済み（整合性メモ反映）

---

## 推奨実装順序

**方針**: ユーザー待ちが発生しない限りは順不問。ユーザー待ちが発生するタスクのみ最後尾へ移動。

対象タスク（順不同）:
- **[NEXT-001]** メタデータ警告対応
- **[TYPE-001]** Supabase 型推論バグ対応
- **[TEST-001]** 既存テスト実行確認
- **[COVERAGE-001]** テストカバレッジ 100% 到達
- **[GAMIFY-001]** Gamification 仕様のフル実装
- **[VISUAL-001]** UI統一感検証と是正
- **[MOBILE-001]** モバイルレスポンシブ検証
- **[PWA-001]** PWA機能検証
- **[ANALYTICS-001]** 統計更新（完了後）
- **[DOC-001]** 設計書確認（随時）

ユーザー待ちが発生する可能性があるタスク（最後尾）:
- **[AUTH-001]** Google OAuth 検証（ユーザー依頼後）

---

## チーム開発への提案

### 現状の強み
✅ コア機能 100% 実装済み  
✅ 型安全性（@ts-nocheck は3ファイルのみ）  
✅ テストスクリプト 8本完備  
✅ ドキュメント充実  

### 次のステップ（推奨）
1. **本番環境への移行準備**
   - Vercel デプロイ設定
   - Supabase プロダクション設定
   - Google OAuth 認証設定（オーナー協力必須）

2. **QA・検証フェーズ**
   - 実機テスト（iOS/Android）
   - ブラウザ互換性確認
   - ネットワーク低速環境でのテスト

3. **デバッグ・ポーランド**
    - 型推論バグの恒久対応
    - エラーハンドリングの統一
    - ロギング・分析の整備
    - UI統一感の検証と是正
    - テストカバレッジ 100% 達成
    - 残課題を極力残さないため、再検証を複数回実施

---

## 作業ロック機構（並行開発向け）

チーム開発時は `.locks/` ディレクトリを活用：
```
.locks/
├── AUTH-001.lock          # Google OAuth 検証者がロック
├── MOBILE-001.lock        # モバイルUX担当者がロック
└── active-tasks.json      # 全体状況を JSON で共有
```

詳細は `docs/guides/TEAM_GUIDE.md` を参照。

---

## 注：削除した重複項目

`implementation-plan.md` v1 で定義されていた以下の項目は、IMPLEMENTATION_STATUS.md と重複していたため削除しました：
- Stamina constraints（既に実装済み）
- Coin/Crystal sinks（既に実装済み）
- Mobile optimization（既に実装済み）
 - Testing to 100% branch coverage（本計画に再追加）
#### [VISUAL-001] UIの統一感検証（目視 + スタイルガイド照合）
- **目的**: UIの統一感を定量/定性で検証し、差分を是正する
- **手法（具体化）**:
  1. **UI回帰スナップショット**（Playwright）
     - 主要画面: `/dashboard`, `/calendar`, `/statistics`, `/login`
     - ブレークポイント: 375 / 768 / 1024
     - 状態: normal / hover / disabled / error / empty（可能な範囲）
     - 差分検知 → 差分の分類（意図/非意図）→ 非意図のみ修正
  2. **デザイントークン監査**
     - Tailwind class / CSS変数の使用状況を抽出
     - 色/余白/角丸/影/フォントの逸脱を一覧化
     - 逸脱はトークンへ統一
  3. **コンポーネント一貫性レビュー**
     - Button / Input / Card / Modal / Toast の見た目・状態遷移を比較
     - 不整合は UIコンポーネント側で吸収
  4. **アクセシビリティ外観チェック**
     - フォーカスリングの統一
     - コントラスト不足の検出と調整
- **成果物**:
  - UIチェックリスト（差分/修正内容）
  - スナップショット差分（before/after）
  - 設計書/実装計画への反映
- **工数**: 1-3日
#### [COVERAGE-001] テストカバレッジ 100% 到達
- **対象**: 全主要ロジック/ユーティリティ/ストア/コンポーネント
- **内容**:
  - 不足テストの追加（ユニット/統合/E2E）
  - テスタビリティ改善（依存分離/純関数化）
  - 失敗修正 → 再実行 → 再検証
  - 設計書反映（達成状況・方針・残課題）
- **工数**: 2-4週間
- **方針**: チームエージェント開発内で完了させる（ユーザー承認不要）
